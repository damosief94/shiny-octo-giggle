name: Ultimate-Win10-CRD

on: 
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-2022
    steps:
      - name: Download Chrome Installer
        shell: pwsh
        run: |
          Invoke-WebRequest -Uri "https://dl.google.com/chrome/install/latest/chrome_installer.exe" -OutFile "chrome_installer.exe"
          Start-Process -FilePath "chrome_installer.exe" -Args "/silent /install" -Wait

      - name: Download and Install CRD
        shell: pwsh
        run: |
          Invoke-WebRequest -Uri "https://dl.google.com/edgedl/chrome-remote-desktop/chromeremotedesktophost.msi" -OutFile "crd.msi"
          Start-Process -FilePath "msiexec.exe" -Args "/i crd.msi /quiet /qn" -Wait

      # ========================================================
      # 1. Ø®Ø·ÙˆØ© ØªØ«Ø¨ÙŠØª VirtualBox (Ø¥ØµØ¯Ø§Ø± 6.1.48)
      # ========================================================
      - name: Install VirtualBox 6.1.48
        shell: pwsh
        run: |
          Write-Host "â¬‡ï¸ Downloading VirtualBox..."
          $vboxUrl = "https://download.virtualbox.org/virtualbox/6.1.48/VirtualBox-6.1.48-159471-Win.exe"
          $installerPath = "VirtualBox-Setup.exe"
          Invoke-WebRequest -Uri $vboxUrl -OutFile $installerPath
          
          Write-Host "âš™ï¸ Installing VirtualBox..."
          # Ø§Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„ØµØ§Ù…Øª Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
          Start-Process -FilePath $installerPath -Args "--silent --ignore-reboot" -Wait
          Write-Host "âœ… VirtualBox Installed Successfully!"

      # ========================================================
      # 2. Ø®Ø·ÙˆØ© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„ÙƒØ¨ÙŠØ± (4GB) ÙˆÙÙƒ Ø§Ù„Ø¶ØºØ· ÙÙŠ Downloads
      # ========================================================
      - name: Download and Extract Large File
        shell: pwsh
        run: |
          # ---------------- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø§Ø¨Ø· ----------------
          # Ø¶Ø¹ Ø±Ø§Ø¨Ø·Ùƒ Ù‡Ù†Ø§ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† XXXXXX ÙˆØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ ?download ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
          $fileUrl = "https://pixeldrain.com/api/file/2G4mcBSa?download"
          # -----------------------------------------------

          $downDir = "$env:USERPROFILE\Downloads"
          $zipPath = "$downDir\BigFile.zip"

          # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø¬Ù„Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª
          if (!(Test-Path -Path $downDir)) { New-Item -ItemType Directory -Force -Path $downDir }

          Write-Host "â¬‡ï¸ Downloading large file (This may take a moment)..."
          # ØªÙ… Ø²ÙŠØ§Ø¯Ø© ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± (Timeout) Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø©
          Invoke-WebRequest -Uri $fileUrl -OutFile $zipPath -TimeoutSec 3600

          Write-Host "ğŸ“¦ Extracting files using 7-Zip (Faster)..."
          # Ø§Ø³ØªØ®Ø¯Ø§Ù… 7z Ù„Ø£Ù†Ù‡ Ø£Ø³Ø±Ø¹ Ø¨ÙƒØ«ÙŠØ± Ù…Ù† Ø£Ø¯Ø§Ø© ÙˆÙŠÙ†Ø¯ÙˆØ² Ù…Ø¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø©
          7z x $zipPath -o"$downDir" -y

          Write-Host "ğŸ§¹ Cleaning up zip file..."
          Remove-Item $zipPath -Force
          Write-Host "âœ… File Ready in: $downDir"

      - name: Start Chrome Remote Desktop
        shell: pwsh
        env:
          CRD_CODE: ${{ secrets.CRD_CODE }}
          CRD_PIN: ${{ secrets.CRD_PIN }}
        run: |
          $exePath = "${Env:PROGRAMFILES(X86)}\Google\Chrome Remote Desktop\CurrentVersion\remoting_start_host.exe"
          & $exePath --code="$env:CRD_CODE" --redirect-url="https://remotedesktop.google.com/_/oauthredirect" --name=$Env:COMPUTERNAME --pin=$env:CRD_PIN

      - name: Success Message
        shell: pwsh
        run: |
          Write-Host "======================================================"
          Write-Host "âœ… Windows 10 Environment is READY!"
          Write-Host "ğŸ“‚ Files are located in: Downloads folder"
          Write-Host "ğŸ”— Go to: https://remotedesktop.google.com/access"
          Write-Host "ğŸ‘‰ Connect to the PC named '$Env:COMPUTERNAME' using your PIN."
          Write-Host "======================================================"

      - name: Keep Alive
        shell: pwsh
        run: |
          while ($true) { Start-Sleep -Seconds 300 }
