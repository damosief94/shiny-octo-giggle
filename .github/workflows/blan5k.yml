name: Ultimate-Win10-CRD

on: 
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-2022
    steps:
      - name: Download Chrome Installer
        shell: pwsh
        run: |
          Invoke-WebRequest -Uri "https://dl.google.com/chrome/install/latest/chrome_installer.exe" -OutFile "chrome_installer.exe"
          Start-Process -FilePath "chrome_installer.exe" -Args "/silent /install" -Wait

      - name: Download and Install CRD
        shell: pwsh
        run: |
          Invoke-WebRequest -Uri "https://dl.google.com/edgedl/chrome-remote-desktop/chromeremotedesktophost.msi" -OutFile "crd.msi"
          Start-Process -FilePath "msiexec.exe" -Args "/i crd.msi /quiet /qn" -Wait

      # ÿ™ÿ´ÿ®Ÿäÿ™ VirtualBox
      - name: Install VirtualBox 6.1.48
        shell: pwsh
        run: |
          Write-Host "‚¨áÔ∏è Downloading VirtualBox..."
          $vboxUrl = "https://download.virtualbox.org/virtualbox/6.1.48/VirtualBox-6.1.48-159471-Win.exe"
          $installerPath = "VirtualBox-Setup.exe"
          
          (New-Object System.Net.WebClient).DownloadFile($vboxUrl, $installerPath)
          
          Write-Host "‚öôÔ∏è Installing VirtualBox..."
          Start-Process -FilePath $installerPath -Args "--silent --ignore-reboot" -Wait
          Write-Host "‚úÖ VirtualBox Installed Successfully!"

      # ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑŸÉÿ®Ÿäÿ± ÿπŸÑŸâ ÿ≥ÿ∑ÿ≠ ÿßŸÑŸÖŸÉÿ™ÿ® (Desktop)
      - name: Download and Extract to DESKTOP
        shell: cmd
        run: |
          @echo off
          echo ‚¨áÔ∏è Downloading large file directly to Desktop...
          
          REM ================================================================
          REM ÿ±ÿßÿ®ÿ∑ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿÆÿßÿµ ÿ®ŸÉ
          set "FILE_URL=https://huggingface.co/datasets/swelam100/rdp/resolve/main/win.zip"
          REM ================================================================

          REM ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ÿ•ŸÑŸâ ÿ≥ÿ∑ÿ≠ ÿßŸÑŸÖŸÉÿ™ÿ® ÿßŸÑÿÆÿßÿµ ÿ®ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ≠ÿßŸÑŸä
          cd /d "%USERPROFILE%\Desktop"
          
          REM ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Curl
          curl -L -o BigFile.zip "%FILE_URL%"

          echo üì¶ Extracting files here...
          7z x BigFile.zip -y
          
          echo üßπ Cleaning up zip file...
          del BigFile.zip
          
          REM ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ ŸÜÿµŸä ŸÑŸÑÿ™ÿ£ŸÉŸäÿØ
          echo Files Downloaded Successfully by Github Actions > "Download_Complete.txt"
          
          echo ‚úÖ Done! Files are on your Desktop.

      - name: Start Chrome Remote Desktop
        shell: pwsh
        env:
          CRD_CODE: ${{ secrets.CRD_CODE4 }}
          CRD_PIN: ${{ secrets.CRD_PIN }}
        run: |
          $exePath = "${Env:PROGRAMFILES(X86)}\Google\Chrome Remote Desktop\CurrentVersion\remoting_start_host.exe"
          
          $UniqueName = "${{ github.actor }}-RDP-${{ github.run_number }}"
          
          Write-Host "======================================================"
          Write-Host "üñ•Ô∏è SETTING RDP NAME TO: $UniqueName"
          Write-Host "======================================================"
          
          & $exePath --code="$env:CRD_CODE" --redirect-url="https://remotedesktop.google.com/_/oauthredirect" --name="$UniqueName" --pin=$env:CRD_PIN

      - name: Success Message
        shell: pwsh
        run: |
          Write-Host "======================================================"
          Write-Host "‚úÖ Windows 10 Environment is READY!"
          Write-Host "üìÇ FILES ARE ON THE DESKTOP (Look for extracted folders)"
          Write-Host "üîó Go to: https://remotedesktop.google.com/access"
          
          $FinalName = "${{ github.actor }}-RDP5-${{ github.run_number }}"
          Write-Host "üëâ Connect to the PC named '$FinalName' using your PIN."
          Write-Host "======================================================"

      - name: Keep Alive
        shell: pwsh
        run: |
          while ($true) { Start-Sleep -Seconds 300 }
